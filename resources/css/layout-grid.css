/**
 * GRID-BASED SEMANTIC LAYOUT
 * Uses grid-template-areas for clean, accessible structure
 *
 * PREFER TAILWIND UTILITY CLASSES WHENEVER POSSIBLE
 *
 * Breakpoints:
 * sm = 640px  | md = 768px | lg = 1024px | xl = 1280px | 2xl = 1536px
**/

@import "tailwindcss";
@import "./_theme.css";

@layer utilities {
    /* ... */
}

:root {
    --template-1-cols: 1fr;
    --template-2-columns: 480px 1fr;
    --template-2-columns-right: 480px 1fr;
    --template-3-columns: 350px 1fr 350px;
}

#page-layout {
    @apply grid min-h-screen w-full;

    /* Simple 3-row layout: nav, main-area, footer */
    grid-template-areas:
        "nav"
        "main-area"
        "foot";
    @apply grid-cols-(--template-1-columns);
    grid-template-rows: auto 1fr auto;

    /* md (768px): sidebars side-by-side under main */
    @media (min-width: 768px) {
        @apply bg-dark;
    }

    /* Grid area assignments */
    > nav {
        grid-area: nav;
        @apply sticky top-0 z-10;
        @apply bg-white shadow-sm border-b border-light;
        @media all and (display-mode: standalone) {
            @apply bg-pink-50;
        }
    }

    > #main-area {
        grid-area: main-area;
        /*@apply border border-amber-200; /* DEBUG */
        @apply grid gap-0;

        > * {
            /*@apply py-4 md:p-4;*/
            @apply py-4 p-4;
        }

        /* sm(640px): vertical stack */
        grid-template-areas:
            "main"
            "sl"
            "sr";
        @apply grid-cols-(--template-1-columns);
        grid-template-rows: auto auto 1fr;

        &:has(.sidebar *) {
            /*@media (max-width: 767px) {
                > *,
                > main > * {
                    @apply h-fit;
                }
            }*/

            /* md(768px): sidebars side-by-side below */
            @media (min-width: 768px) {
                &:has(.sidebar-left *):has(.sidebar-right *) {
                    grid-template-areas:
                        "main   main"
                        "sl     sr";
                    grid-template-columns: 1fr 1fr;
                    grid-template-rows: 1fr auto;
                }
            }

            /* lg(1024px): sidebars beside main */
            @media (min-width: 1024px) {
                grid-template-areas:
                    "sl     main"
                    "sr     main";
                @apply grid-cols-(--template-2-columns);
                grid-template-rows: auto 1fr;
            }

            /* 2xl(1536px): 3 columns */
            @media (min-width: 1536px) {
                grid-template-areas: "sl     main   sr";
                @apply grid-cols-(--template-3-columns);
                grid-template-rows: 1fr;

                /* Only left sidebar */
                &:has(#sidebar-left *):not(:has(#sidebar-right *)) {
                    @apply grid-cols-(--template-2-columns);
                    grid-template-areas: "sl     main";
                }

                /* Only right sidebar */
                &:has(#sidebar-right *):not(:has(#sidebar-left *)) {
                    grid-template-areas: "main   sr";
                    @apply grid-cols-(--template-2-columns-right);
                }
            }
        }

        /*:has(#sidebar-left *):not(:has(#sidebar-right *)) {
            #sidebar-right {
                @apply hidden;
            }
        }

        :has(#sidebar-right *):not(:has(#sidebar-left *)) {
            #sidebar-left {
                @apply hidden;
            }
        }*/

        &:not(:has(.sidebar *, .full-width *)) {
            main {
                @apply max-w-6xl mx-auto;
            }
        }

        > main {
            grid-area: main;
            /*@apply self-start;*/
            @media (min-width: 1536px) {
                @apply max-w-none;
            }
        }
        /*}*/

        > * > .wrapper {
            /* Not implemented yet, would allow both fill height and sticky */
            @apply 2xl:sticky 2xl:inset-y-16 2xl:h-fit;
        }

        > main {
            /*@apply border border-green-300; /* DEBUG */
            @apply bg-light;
            @apply space-y-8;
            @apply place-self-stretch;

            > header {
                &:not(:has(*)) {
                    @apply hidden;
                }
            }
        }

        .sidebar {
            @apply p-4;
            @apply lg:h-fit sticky top-0;
            @apply place-self-stretch;
            /*@apply 2xl:sticky 2xl:inset-y-16;*/

            &:not(:has(*)) {
                @apply hidden;
            }

            &#sidebar-left {
                /*@apply border border-blue-300; /* DEBUG */
                grid-area: sl;
            }

            &#sidebar-right {
                /*@apply border border-red-300; /* DEBUG */
                grid-area: sr;
            }
        }
    }

    > footer {
        grid-area: foot;
        @apply sticky bottom-0 z-10;

        /* Hide footer if empty */
        &:not(:has(*)) {
            @apply hidden;
        }
    }
}

main {
    @apply w-full;
}

/* Container query support for sidebars */
#sidebar-left,
#sidebar-right {
    container-type: inline-size;
}

/* Reset margins for first/last children */
#main-area > header,
#main-area > main,
.sidebar,
.card {
    > :first-child {
        @apply mt-0;
    }

    > :last-child {
        @apply mb-0;
    }
}
